name: Hexo-deploy

on:
  push:
    branches: [ main ]  # 你的博客源码分支

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. 拉取博客源码（包含 Hexo 配置、文章、主题）
      - name: 拉取代码
        uses: actions/checkout@v4
        with:
          # 如果主题是通过 git submodule 引入的，必须加这行拉取子模块
          submodules: true
          fetch-depth: 0

      # 2. 安装 Node.js 环境（Hexo 推荐 16+/18+，避免版本过高/过低报错）
      - name: 安装 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.20.0'
          cache: 'npm'  # 缓存 npm 依赖，加速构建

      # 3. 安装 Hexo 核心依赖和项目依赖
      - name: 安装 Hexo 及项目依赖
        run: |
          # 全局安装 Hexo 脚手架（必须）
          npm install -g hexo-cli
          # 安装博客目录下的 package.json 依赖（主题/插件等）
          npm install

      # 4. 清理旧编译文件 + 编译生成静态页面
      - name: 编译 Hexo 博客
        run: |
          hexo clean  # 清理之前的 public 目录，避免缓存问题
          hexo generate  # 编译生成新的 public 目录

      # 5. 部署到 GitHub Pages
      - name: 部署到 GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # Hexo 编译后的输出目录固定为 public，不要改
          publish_dir: ./public
          # 可选：部署到 gh-pages 分支（GitHub Pages 默认分支）
          publish_branch: gh-pages